<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>BookVerse | Find Your Next Obsession</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;family=Fraunces:opsz,wght@9..144,700;9..144,900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3713ec",
                        "lime-accent": "#bef264",
                        "background-light": "#f6f6f8",
                        "background-dark": "#0a0a0a",
                        "card-dark": "#16161a",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"],
                        "serif": ["Fraunces", "serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                },
            },
        }
    </script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-auto-rows: minmax(100px, auto);
            gap: 1.5rem;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #333; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #444; 
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-white transition-colors duration-300 min-h-screen flex flex-col">

<!-- Top Navigation -->
<header class="sticky top-0 z-50 w-full glass border-b border-white/10 px-6 py-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div class="flex items-center gap-2 cursor-pointer" onclick="app.resetView()">
            <div class="bg-primary p-1.5 rounded-lg">
                <span class="material-symbols-outlined text-white">auto_stories</span>
            </div>
            <h1 class="font-serif text-2xl font-black tracking-tighter text-white">BookVerse</h1>
        </div>
        <nav class="hidden md:flex items-center gap-8">
            <a class="text-sm font-semibold hover:text-lime-accent transition-colors" href="#" onclick="app.resetView()">Discover</a>
            <a class="text-sm font-semibold hover:text-lime-accent transition-colors" href="#category-section">Categories</a>
            <a class="text-sm font-semibold hover:text-lime-accent transition-colors" href="#vibe-section">Vibe Check</a>
            <a class="text-sm font-semibold hover:text-lime-accent transition-colors" href="#">Community</a>
            <a class="text-sm font-semibold hover:text-lime-accent transition-colors" href="#">My Shelf</a>
        </nav>
        <div class="flex items-center gap-4">
            <button class="hidden sm:block text-sm font-bold px-4 py-2 rounded-xl hover:bg-white/5 transition-all">Log In</button>
            <button class="bg-primary text-white text-sm font-bold px-6 py-2.5 rounded-xl shadow-lg shadow-primary/20 hover:scale-105 transition-transform">
                Get Started
            </button>
        </div>
    </div>
</header>

<main class="max-w-7xl mx-auto px-6 py-10 flex-grow w-full relative">
    
    <!-- Loading Overlay -->
    <div id="loading-indicator" class="hidden fixed inset-0 z-[60] bg-background-dark/80 backdrop-blur-sm flex items-center justify-center">
        <div class="flex flex-col items-center gap-4">
            <span class="material-symbols-outlined text-primary text-5xl animate-spin">progress_activity</span>
            <p class="text-white font-bold animate-pulse">Consulting the algorithm...</p>
        </div>
    </div>

    <!-- MAIN HOME VIEW (Bento Grid) -->
    <div id="home-view" class="bento-grid transition-opacity duration-300">
        <!-- Main Search Tile -->
        <div class="col-span-12 lg:col-span-8 bg-card-dark rounded-xl p-8 lg:p-12 relative overflow-hidden flex flex-col justify-center min-h-[400px]">
            <div class="absolute top-0 right-0 -mr-20 -mt-20 w-80 h-80 bg-primary/20 blur-[100px] rounded-full"></div>
            <div class="relative z-10 space-y-6">
                <span class="inline-block px-3 py-1 bg-lime-accent text-black text-[10px] font-black uppercase tracking-widest rounded-full">Trending Now</span>
                <h2 class="font-serif text-5xl lg:text-7xl font-black leading-[1.1] tracking-tight text-white">
                    Your library, but <br/><span class="text-primary italic">make it iconic.</span>
                </h2>
                <p class="text-zinc-400 text-lg max-w-md">Find your next obsession. Search by vibe, trope, or the title you forgot the name of.</p>
                
                <!-- Search Bar Component -->
                <div class="flex max-w-xl bg-white/5 border border-white/10 rounded-2xl p-2 focus-within:border-primary transition-all">
                    <div class="flex items-center px-4 text-zinc-500">
                        <span class="material-symbols-outlined">search</span>
                    </div>
                    <input id="main-search-input" class="bg-transparent border-none focus:ring-0 text-white w-full placeholder:text-zinc-600 font-medium" placeholder="Find your next obsession..." type="text"/>
                    <button onclick="app.handleSearch()" class="bg-primary px-6 py-3 rounded-xl font-bold text-sm hover:bg-opacity-90 transition-all">Search</button>
                </div>
            </div>
        </div>

        <!-- Featured "Book of the Week" Tile -->
        <div class="col-span-12 md:col-span-6 lg:col-span-4 glass rounded-xl p-8 flex flex-col justify-between group cursor-pointer hover:border-lime-accent/50 transition-colors" onclick="app.showDetails(1)">
            <div class="relative w-full aspect-[3/4] rounded-lg overflow-hidden shadow-2xl group-hover:scale-105 transition-transform duration-500">
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent z-10"></div>
                <img class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1544947950-fa07a98d237f?auto=format&fit=crop&q=80&w=800" alt="The Secret History cover"/>
                <div class="absolute bottom-4 left-4 z-20">
                    <p class="text-lime-accent text-xs font-bold mb-1">BOOK OF THE WEEK</p>
                    <h3 class="font-serif text-2xl font-black">The Secret History</h3>
                </div>
            </div>
            <div class="mt-6 flex justify-between items-center">
                <div class="flex -space-x-2">
                    <div class="w-8 h-8 rounded-full border-2 border-card-dark bg-zinc-800 flex items-center justify-center text-[10px]">+12k</div>
                    <div class="w-8 h-8 rounded-full border-2 border-card-dark bg-zinc-700 flex items-center justify-center text-[10px] text-zinc-400">JD</div>
                    <div class="w-8 h-8 rounded-full border-2 border-card-dark bg-zinc-600 flex items-center justify-center text-[10px] text-zinc-400">AB</div>
                </div>
                <span class="text-sm font-bold text-zinc-400">Reading now</span>
            </div>
        </div>

        <!-- Vibe Check Section Header -->
        <div id="vibe-section" class="col-span-12 mt-8">
            <div class="flex items-center justify-between px-2">
                <h3 class="font-serif text-3xl font-black">Vibe Check</h3>
                <button onclick="app.filterByVibe('all')" class="text-primary font-bold text-sm flex items-center gap-1 hover:underline">
                    View All <span class="material-symbols-outlined text-sm">arrow_forward</span>
                </button>
            </div>
        </div>

        <!-- Chips / Filters Tile -->
        <div class="col-span-12 flex flex-wrap gap-3 py-2 px-2" id="vibe-chips">
            <!-- Chips generated by JS or hardcoded below -->
            <button onclick="app.filterByVibe('Chaotic')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">bolt</span>
                <p class="text-sm font-bold leading-normal">Chaotic</p>
            </button>
            <button onclick="app.filterByVibe('Comfy')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">bedtime</span>
                <p class="text-sm font-bold leading-normal">Comfy</p>
            </button>
            <button onclick="app.filterByVibe('Brain Rot')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">psychology</span>
                <p class="text-sm font-bold leading-normal">Brain Rot</p>
            </button>
             <button onclick="app.filterByVibe('Dark Academia')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">school</span>
                <p class="text-sm font-bold leading-normal">Dark Academia</p>
            </button>
            <button onclick="app.filterByVibe('Main Character')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">star</span>
                <p class="text-sm font-bold leading-normal">Main Character</p>
            </button>
            <button onclick="app.filterByVibe('Heart-Wrenching')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">sentiment_very_dissatisfied</span>
                <p class="text-sm font-bold leading-normal">Heart-Wrenching</p>
            </button>
            <button onclick="app.filterByVibe('Spicy')" class="group flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-xl bg-white/5 text-zinc-400 px-6 cursor-pointer border border-white/5 hover:bg-primary hover:text-white hover:border-primary transition-all">
                <span class="material-symbols-outlined text-lg">local_fire_department</span>
                <p class="text-sm font-bold leading-normal">Spicy</p>
            </button>
        </div>

        <!-- NEW CATEGORIES SECTION -->
        <div id="category-section" class="col-span-12 mt-8">
             <div class="flex items-center justify-between px-2">
                <h3 class="font-serif text-3xl font-black">Browse by Genre</h3>
            </div>
        </div>

        <div class="col-span-12 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3 px-2">
             <button onclick="app.searchByCategory('Romance')" class="p-4 rounded-xl bg-zinc-900 border border-white/5 hover:border-primary hover:bg-zinc-800 transition-all text-center group">
                <span class="block text-2xl mb-2 transform group-hover:scale-110 transition-transform">üíò</span>
                <span class="font-bold text-sm text-zinc-400 group-hover:text-white">Romance</span>
             </button>
             <button onclick="app.searchByCategory('Mystery')" class="p-4 rounded-xl bg-zinc-900 border border-white/5 hover:border-primary hover:bg-zinc-800 transition-all text-center group">
                <span class="block text-2xl mb-2 transform group-hover:scale-110 transition-transform">üîç</span>
                <span class="font-bold text-sm text-zinc-400 group-hover:text-white">Mystery</span>
             </button>
             <button onclick="app.searchByCategory('Fantasy')" class="p-4 rounded-xl bg-zinc-900 border border-white/5 hover:border-primary hover:bg-zinc-800 transition-all text-center group">
                <span class="block text-2xl mb-2 transform group-hover:scale-110 transition-transform">üêâ</span>
                <span class="font-bold text-sm text-zinc-400 group-hover:text-white">Fantasy</span>
             </button>
             <button onclick="app.searchByCategory('Sci-Fi')" class="p-4 rounded-xl bg-zinc-900 border border-white/5 hover:border-primary hover:bg-zinc-800 transition-all text-center group">
                <span class="block text-2xl mb-2 transform group-hover:scale-110 transition-transform">üöÄ</span>
                <span class="font-bold text-sm text-zinc-400 group-hover:text-white">Sci-Fi</span>
             </button>
             <button onclick="app.searchByCategory('Thriller')" class="p-4 rounded-xl bg-zinc-900 border border-white/5 hover:border-primary hover:bg-zinc-800 transition-all text-center group">
                <span class="block text-2xl mb-2 transform group-hover:scale-110 transition-transform">üî™</span>
                <span class="font-bold text-sm text-zinc-400 group-hover:text-white">Thriller</span>
             </button>
             <button onclick="app.searchByCategory('History')" class="p-4 rounded-xl bg-zinc-900 border border-white/5 hover:border-primary hover:bg-zinc-800 transition-all text-center group">
                <span class="block text-2xl mb-2 transform group-hover:scale-110 transition-transform">üèõÔ∏è</span>
                <span class="font-bold text-sm text-zinc-400 group-hover:text-white">History</span>
             </button>
        </div>

        <!-- Bento Category: BookTok Hits -->
        <div class="col-span-12 md:col-span-7 bg-indigo-600 rounded-xl p-8 relative overflow-hidden group cursor-pointer hover:bg-indigo-700 transition-colors" onclick="app.filterByVibe('BookTok')">
            <div class="absolute -right-10 -bottom-10 opacity-20 group-hover:scale-110 transition-transform duration-700">
                <span class="material-symbols-outlined text-[200px]">trending_up</span>
            </div>
            <div class="relative z-10">
                <h4 class="font-serif text-4xl font-black mb-4">BookTok <br/>Hits</h4>
                <p class="text-white/80 max-w-xs mb-8">What everyone's screaming about on your FYP right now.</p>
                <div class="flex gap-4">
                    <div class="w-24 h-36 bg-zinc-900 rounded shadow-xl rotate-[-6deg] overflow-hidden border border-white/10">
                         <img class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1629198688000-71f23e745b6e?auto=format&fit=crop&q=80&w=400" alt="Book cover"/>
                    </div>
                    <div class="w-24 h-36 bg-zinc-900 rounded shadow-xl rotate-[3deg] overflow-hidden -ml-8 border border-white/10">
                         <img class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1541963463532-d68292c34b19?auto=format&fit=crop&q=80&w=400" alt="Book cover"/>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bento Category: Community Feed -->
        <div class="col-span-12 md:col-span-5 glass rounded-xl p-6">
            <h4 class="text-sm font-black uppercase tracking-widest text-zinc-500 mb-6">Live Community</h4>
            <div class="space-y-4" id="community-feed">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Secondary Bento Row -->
        <div class="col-span-12 md:col-span-4 bg-zinc-900 rounded-xl p-8 group cursor-pointer border border-white/5 hover:border-primary/50 transition-all" onclick="app.filterByVibe('Dark Academia')">
            <span class="material-symbols-outlined text-primary mb-4 text-3xl">menu_book</span>
            <h4 class="font-serif text-2xl font-black mb-2">Dark Academia</h4>
            <p class="text-zinc-500 text-sm mb-6">Elitism, tweed jackets, and murder mysteries in libraries.</p>
            <div class="w-full h-1 bg-zinc-800 rounded-full overflow-hidden">
                <div class="w-2/3 h-full bg-primary group-hover:w-full transition-all duration-500"></div>
            </div>
        </div>

        <div class="col-span-12 md:col-span-4 bg-zinc-900 rounded-xl p-8 group cursor-pointer border border-white/5 hover:border-lime-accent/50 transition-all" onclick="app.filterByVibe('Heart-Wrenching')">
            <span class="material-symbols-outlined text-lime-accent mb-4 text-3xl">heart_broken</span>
            <h4 class="font-serif text-2xl font-black mb-2">Sad Girl Starter Pack</h4>
            <p class="text-zinc-500 text-sm mb-6">Joan Didion vibes and books that make you question existence.</p>
            <div class="w-full h-1 bg-zinc-800 rounded-full overflow-hidden">
                <div class="w-1/2 h-full bg-lime-accent group-hover:w-3/4 transition-all duration-500"></div>
            </div>
        </div>

        <div class="col-span-12 md:col-span-4 bg-primary rounded-xl p-8 flex flex-col justify-center items-center text-center group cursor-pointer hover:bg-primary/90 transition-colors" onclick="app.surpriseMe()">
            <h4 class="font-serif text-2xl font-black mb-2 italic">Surprise Me</h4>
            <p class="text-white/80 text-sm mb-6">Let the algorithm choose your next identity.</p>
            <button class="w-12 h-12 bg-white rounded-full flex items-center justify-center group-hover:rotate-180 transition-transform duration-500">
                <span class="material-symbols-outlined text-primary">shuffle</span>
            </button>
        </div>
    </div>

    <!-- RESULTS VIEW (Hidden by default) -->
    <div id="results-view" class="hidden animate-fade-in w-full">
        <div class="flex items-center justify-between mb-8">
            <div>
                <button onclick="app.resetView()" class="text-zinc-400 hover:text-white flex items-center gap-2 mb-2 transition-colors text-sm font-bold">
                    <span class="material-symbols-outlined text-sm">arrow_back</span> Back to Home
                </button>
                <h2 id="results-title" class="font-serif text-4xl font-black text-white">Search Results</h2>
            </div>
            
            <!-- Filter Dropdown for Results -->
            <div class="relative group">
                <button class="flex items-center gap-2 bg-white/5 border border-white/10 px-4 py-2 rounded-lg text-sm font-bold hover:bg-white/10 transition-colors">
                    <span class="material-symbols-outlined text-sm">filter_list</span> Filter
                </button>
            </div>
        </div>

        <!-- Results Grid -->
        <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- Cards injected here -->
        </div>

        <!-- Empty State (Hidden) -->
        <div id="empty-state" class="hidden flex-col items-center justify-center py-20 text-center">
            <span class="material-symbols-outlined text-zinc-600 text-6xl mb-4">search_off</span>
            <h3 class="font-serif text-2xl font-bold text-white mb-2">No vibes found</h3>
            <p class="text-zinc-500 max-w-sm">We couldn't find anything matching that. Try "Spicy", "Fantasy", or "Colleen".</p>
            <button onclick="app.resetView()" class="mt-6 text-primary font-bold hover:underline">Clear Search</button>
        </div>
    </div>

</main>

<footer class="mt-auto border-t border-white/10 py-12 px-6">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
        <div class="flex items-center gap-2">
            <div class="bg-primary/20 p-1.5 rounded-lg border border-primary/30">
                <span class="material-symbols-outlined text-primary text-sm">auto_stories</span>
            </div>
            <h1 class="font-serif text-xl font-black tracking-tighter text-white">BookVerse</h1>
        </div>
        <p class="text-zinc-500 text-xs font-medium">¬© 2024 BookVerse. Made for the icons.</p>
        <div class="flex gap-6">
            <a class="text-zinc-400 hover:text-white transition-colors" href="#"><span class="material-symbols-outlined">brand_awareness</span></a>
            <a class="text-zinc-400 hover:text-white transition-colors" href="#"><span class="material-symbols-outlined">share</span></a>
            <a class="text-zinc-400 hover:text-white transition-colors" href="#"><span class="material-symbols-outlined">mail</span></a>
        </div>
    </div>
</footer>

<!-- BACKEND LOGIC & APP CONTROLLER -->
<script>
    /**
     * MOCK DATABASE
     * Kept for Vibe Checks and random suggestions
     */
    const bookDatabase = [
        { id: 1, title: "The Secret History", author: "Donna Tartt", vibe: "Dark Academia", tags: ["chaotic", "murder", "classics"], img: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?auto=format&fit=crop&q=80&w=800", rating: 4.8 },
        { id: 2, title: "Fourth Wing", author: "Rebecca Yarros", vibe: "Spicy", tags: ["fantasy", "dragons", "romance"], img: "https://images.unsplash.com/photo-1629198688000-71f23e745b6e?auto=format&fit=crop&q=80&w=800", rating: 4.9 },
        { id: 3, title: "Bunny", author: "Mona Awad", vibe: "Brain Rot", tags: ["weird", "dark", "campus"], img: "https://images.unsplash.com/photo-1532012197267-da84d127e765?auto=format&fit=crop&q=80&w=800", rating: 3.7 },
        { id: 4, title: "Normal People", author: "Sally Rooney", vibe: "Heart-Wrenching", tags: ["sad girl", "romance", "contemporary"], img: "https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&q=80&w=800", rating: 4.2 },
        { id: 5, title: "A Court of Thorns and Roses", author: "Sarah J. Maas", vibe: "Spicy", tags: ["fantasy", "fae", "romance"], img: "https://images.unsplash.com/photo-1519681393798-38e34e918b19?auto=format&fit=crop&q=80&w=800", rating: 4.5 },
        { id: 6, title: "My Year of Rest and Relaxation", author: "Ottessa Moshfegh", vibe: "Comfy", tags: ["sad girl", "sleep", "unhinged"], img: "https://images.unsplash.com/photo-1491841550275-ad7854e35ca6?auto=format&fit=crop&q=80&w=800", rating: 3.9 },
        { id: 7, title: "Babel", author: "R.F. Kuang", vibe: "Dark Academia", tags: ["fantasy", "history", "colonialism"], img: "https://images.unsplash.com/photo-1589829085413-56de8ae18c73?auto=format&fit=crop&q=80&w=800", rating: 4.7 },
        { id: 8, title: "Happy Place", author: "Emily Henry", vibe: "Comfy", tags: ["romance", "summer", "contemporary"], img: "https://images.unsplash.com/photo-1476275466078-4007374efbbe?auto=format&fit=crop&q=80&w=800", rating: 4.3 },
        { id: 9, title: "Iron Flame", author: "Rebecca Yarros", vibe: "Spicy", tags: ["fantasy", "war", "dragons"], img: "https://images.unsplash.com/photo-1614544048536-0d28caf77f41?auto=format&fit=crop&q=80&w=800", rating: 4.6 },
        { id: 10, title: "Yellowface", author: "R.F. Kuang", vibe: "Chaotic", tags: ["thriller", "publishing", "satire"], img: "https://images.unsplash.com/photo-1543002588-bfa74002ed7e?auto=format&fit=crop&q=80&w=800", rating: 4.1 },
        { id: 11, title: "Tomorrow, and Tomorrow, and Tomorrow", author: "Gabrielle Zevin", vibe: "Main Character", tags: ["gaming", "friends", "sad"], img: "https://images.unsplash.com/photo-1497633762265-9d179a990aa6?auto=format&fit=crop&q=80&w=800", rating: 4.4 },
        { id: 12, title: "Haunting Adeline", author: "H.D. Carlton", vibe: "Chaotic", tags: ["dark romance", "thriller"], img: "https://images.unsplash.com/photo-1633477189729-9290b3261d0a?auto=format&fit=crop&q=80&w=800", rating: 3.5 }
    ];

    /**
     * BACKEND SERVICE CLASS
     * REAL API INTEGRATION
     */
    class BackendService {
        constructor() {
            this.latency = 600; // Still used for internal mock data calls
            this.vibes = ["Chaotic", "Comfy", "Brain Rot", "Dark Academia", "Main Character", "Heart-Wrenching", "Spicy"];
        }

        async searchBooks(query) {
            // REAL API CALL TO OPEN LIBRARY
            if (!query) return [];
            
            try {
                // Using limit=12 to keep the grid clean
                const response = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=12`);
                const data = await response.json();

                // Transform API Data to App Format
                return data.docs.map(doc => {
                    const hasCover = doc.cover_i;
                    return {
                        id: doc.key,
                        title: doc.title,
                        author: doc.author_name ? doc.author_name[0] : "Unknown Author",
                        // Synthesize a vibe since API doesn't have it
                        vibe: this.getRandomVibe(),
                        tags: doc.subject ? doc.subject.slice(0, 3) : ["General"],
                        // Use Open Library Cover API or a nice fallback
                        img: hasCover 
                            ? `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg` 
                            : 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?auto=format&fit=crop&q=80&w=800', 
                        rating: (doc.ratings_average || (Math.random() * 1.5 + 3.5)).toFixed(1)
                    };
                });

            } catch (error) {
                console.error("Open Library API Error:", error);
                return []; // Return empty array on failure so app doesn't crash
            }
        }

        // Helper to keep the UI consistent even with external data
        getRandomVibe() {
            return this.vibes[Math.floor(Math.random() * this.vibes.length)];
        }

        async getBooksByVibe(vibe) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (vibe === 'all' || vibe === 'BookTok') return resolve(bookDatabase);
                    const results = bookDatabase.filter(book => 
                        book.vibe.toLowerCase() === vibe.toLowerCase() ||
                        book.tags.includes(vibe.toLowerCase())
                    );
                    resolve(results);
                }, this.latency);
            });
        }

        async getRandomBook() {
             return new Promise((resolve) => {
                setTimeout(() => {
                    const random = bookDatabase[Math.floor(Math.random() * bookDatabase.length)];
                    resolve([random]);
                }, this.latency);
            });
        }
    }

    /**
     * APP CONTROLLER
     * Handles UI updates and connects to the Backend Service.
     */
    class AppController {
        constructor() {
            this.service = new BackendService();
            this.initListeners();
            this.renderCommunityFeed();
        }

        initListeners() {
            const input = document.getElementById('main-search-input');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.handleSearch();
            });
        }

        // --- Core Actions ---

        async handleSearch() {
            const query = document.getElementById('main-search-input').value;
            if (!query) return;

            this.showLoading(true);
            const results = await this.service.searchBooks(query);
            this.displayResults(results, `Results for "${query}"`);
            this.showLoading(false);
        }

        // Wrapper to search by category
        searchByCategory(category) {
            // Update the search box to reflect the category
            document.getElementById('main-search-input').value = category;
            // Trigger the standard search
            this.handleSearch();
        }

        async filterByVibe(vibe) {
            this.showLoading(true);
            const results = await this.service.getBooksByVibe(vibe);
            const title = vibe === 'all' ? 'All Books' : `${vibe} Vibes`;
            this.displayResults(results, title);
            this.showLoading(false);
        }

        async surpriseMe() {
            this.showLoading(true);
            const result = await this.service.getRandomBook();
            this.displayResults(result, "Your Next Obsession");
            this.showLoading(false);
        }

        // --- UI Rendering ---

        displayResults(books, title) {
            // Hide Home, Show Results
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('results-view').classList.remove('hidden');
            
            // Update Title
            document.getElementById('results-title').innerText = title;

            // Render Grid
            const grid = document.getElementById('results-grid');
            const emptyState = document.getElementById('empty-state');
            grid.innerHTML = '';

            if (books.length === 0) {
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
            } else {
                emptyState.classList.add('hidden');
                emptyState.classList.remove('flex');
                
                books.forEach(book => {
                    const card = `
                        <div class="group relative flex flex-col gap-3 animate-fade-in">
                            <div class="relative w-full aspect-[2/3] rounded-lg overflow-hidden border border-white/5 bg-zinc-900 group-hover:border-primary/50 transition-all shadow-lg shadow-black/50">
                                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors z-10"></div>
                                <img src="${book.img}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700" loading="lazy" />
                                <div class="absolute top-2 right-2 z-20 bg-black/60 backdrop-blur-md px-2 py-1 rounded text-[10px] font-bold border border-white/10 flex items-center gap-1">
                                    <span class="material-symbols-outlined text-[12px] text-yellow-400">star</span> ${book.rating}
                                </div>
                            </div>
                            <div>
                                <h4 class="font-serif font-bold text-lg leading-tight truncate text-white group-hover:text-primary transition-colors">${book.title}</h4>
                                <p class="text-zinc-500 text-sm truncate">${book.author}</p>
                            </div>
                             <div class="flex flex-wrap gap-1 mt-1">
                                <span class="text-[10px] px-2 py-0.5 rounded-full bg-primary/20 text-primary border border-primary/20">${book.vibe}</span>
                            </div>
                        </div>
                    `;
                    grid.innerHTML += card;
                });
            }
        }

        resetView() {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('results-view').classList.add('hidden');
            document.getElementById('main-search-input').value = '';
        }

        showLoading(isLoading) {
            const el = document.getElementById('loading-indicator');
            if (isLoading) el.classList.remove('hidden');
            else el.classList.add('hidden');
        }

        // --- Simulating Live Data ---

        renderCommunityFeed() {
            const feedContainer = document.getElementById('community-feed');
            const activities = [
                { user: 'Jordan', action: 'just finished', book: 'Fourth Wing', text: '"Literally screaming at the ending..."', color: 'bg-primary' },
                { user: 'Mila', action: 'added', book: 'Bunny', text: '"The weirdest thing I\'ve ever read."', color: 'bg-lime-accent text-black' },
                { user: 'Alex', action: 'is looking for', book: 'Sad Girl vibes', text: null, color: 'bg-zinc-700' }
            ];

            const render = () => {
                feedContainer.innerHTML = activities.map(act => `
                    <div class="flex items-start gap-4 p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-all border border-transparent hover:border-white/10">
                        <div class="w-10 h-10 rounded-full ${act.color} flex-shrink-0 flex items-center justify-center font-bold text-sm">
                            ${act.user.substring(0,2).toUpperCase()}
                        </div>
                        <div>
                            <p class="text-xs text-zinc-400"><span class="text-white font-bold">${act.user}</span> ${act.action} <span class="text-primary italic font-bold">${act.book}</span></p>
                            ${act.text ? `<p class="text-xs italic text-zinc-500 mt-1">${act.text}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            };
            
            render();
        }
    }

    // Initialize App
    const app = new AppController();
</script>
</body>
</html>
